{% extends "base.html" %}

{% block extrahead %}
  {{ super() }}
  <script type="text/javascript">
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'en',
        includedLanguages: 'es,fr,de,pt,ja,zh-CN,zh-TW,ko,ru,it,nl,pl,tr,ar,hi,id,th,vi',
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
        autoDisplay: false
      }, 'google_translate_element');
    }

    // Language configuration with flags
    const languages = [
      { code: 'en', name: 'English', flag: 'ğŸ‡¬ğŸ‡§' },
      { code: 'es', name: 'EspaÃ±ol', flag: 'ğŸ‡ªğŸ‡¸' },
      { code: 'fr', name: 'FranÃ§ais', flag: 'ğŸ‡«ğŸ‡·' },
      { code: 'de', name: 'Deutsch', flag: 'ğŸ‡©ğŸ‡ª' },
      { code: 'pt', name: 'PortuguÃªs', flag: 'ğŸ‡µğŸ‡¹' },
      { code: 'ja', name: 'æ—¥æœ¬èª', flag: 'ğŸ‡¯ğŸ‡µ' },
      { code: 'zh-CN', name: 'ç®€ä½“ä¸­æ–‡', flag: 'ğŸ‡¨ğŸ‡³' },
      { code: 'zh-TW', name: 'ç¹é«”ä¸­æ–‡', flag: 'ğŸ‡¹ğŸ‡¼' },
      { code: 'ko', name: 'í•œêµ­ì–´', flag: 'ğŸ‡°ğŸ‡·' },
      { code: 'ru', name: 'Ğ ÑƒÑÑĞºĞ¸Ğ¹', flag: 'ğŸ‡·ğŸ‡º' },
      { code: 'it', name: 'Italiano', flag: 'ğŸ‡®ğŸ‡¹' },
      { code: 'nl', name: 'Nederlands', flag: 'ğŸ‡³ğŸ‡±' },
      { code: 'pl', name: 'Polski', flag: 'ğŸ‡µğŸ‡±' },
      { code: 'tr', name: 'TÃ¼rkÃ§e', flag: 'ğŸ‡¹ğŸ‡·' },
      { code: 'ar', name: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', flag: 'ğŸ‡¸ğŸ‡¦' },
      { code: 'hi', name: 'à¤¹à¤¿à¤¨à¥à¤¦à¥€', flag: 'ğŸ‡®ğŸ‡³' },
      { code: 'id', name: 'Bahasa Indonesia', flag: 'ğŸ‡®ğŸ‡©' },
      { code: 'th', name: 'à¹„à¸—à¸¢', flag: 'ğŸ‡¹ğŸ‡­' },
      { code: 'vi', name: 'Tiáº¿ng Viá»‡t', flag: 'ğŸ‡»ğŸ‡³' }
    ];

    function clearGoogleTranslate() {
      // Clear all Google Translate cookies
      const cookies = document.cookie.split(";");
      for (let cookie of cookies) {
        const eqPos = cookie.indexOf("=");
        const name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();
        if (name.includes('googtrans') || name.includes('google')) {
          document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
          document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=" + window.location.hostname;
          document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=." + window.location.hostname;
        }
      }

      // Clear localStorage
      try {
        Object.keys(localStorage).forEach(key => {
          if (key.includes('google') || key.includes('trans')) {
            localStorage.removeItem(key);
          }
        });
      } catch (e) {}

      // Clear sessionStorage
      try {
        Object.keys(sessionStorage).forEach(key => {
          if (key.includes('google') || key.includes('trans')) {
            sessionStorage.removeItem(key);
          }
        });
      } catch (e) {}
    }

    function changeLanguage(langCode) {
      // Clear all translate state first
      clearGoogleTranslate();

      if (langCode === 'en') {
        // For English, just reload without any translation
        window.location.href = window.location.pathname + window.location.search;
        return;
      }

      // Set the language cookie for Google Translate
      const langPair = '/en/' + langCode;
      document.cookie = 'googtrans=' + langPair + ';path=/;domain=' + window.location.hostname;
      document.cookie = 'googtrans=' + langPair + ';path=/;domain=.' + window.location.hostname;
      document.cookie = 'googtrans=' + langPair + ';path=/';

      // Force a complete page reload to apply the translation
      window.location.href = window.location.pathname + window.location.search + '#googtrans(' + langPair + ')';
      window.location.reload(true);
    }

    function getCurrentLanguage() {
      const cookies = document.cookie.split(';');
      for (let cookie of cookies) {
        const parts = cookie.trim().split('=');
        if (parts[0] === 'googtrans') {
          const langPair = parts[1];
          const match = langPair.match(/\/en\/([a-zA-Z-]+)/);
          return match ? match[1] : 'en';
        }
      }

      // Check URL hash
      const hash = window.location.hash;
      if (hash.includes('googtrans')) {
        const match = hash.match(/googtrans\(\/en\/([a-zA-Z-]+)\)/);
        return match ? match[1] : 'en';
      }

      return 'en';
    }

    function updateLanguageSelector() {
      const currentLang = getCurrentLanguage();
      const selector = document.getElementById('language-selector-button');
      if (selector) {
        const lang = languages.find(l => l.code === currentLang) || languages[0];
        selector.innerHTML = lang.flag + ' <span class="lang-name">' + lang.name + '</span>';
      }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      updateLanguageSelector();
    });
  </script>
  <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
  <style>
    /* Hide the default Google Translate widget */
    #google_translate_element {
      display: none !important;
    }

    /* Hide Google Translate banner */
    .goog-te-banner-frame.skiptranslate {
      display: none !important;
    }

    body {
      top: 0px !important;
    }

    /* Custom language selector styling */
    .language-selector {
      position: relative;
      display: inline-block;
    }

    .language-selector-button {
      background-color: var(--md-default-bg-color);
      color: var(--md-default-fg-color);
      border: 1px solid var(--md-primary-fg-color);
      border-radius: 4px;
      padding: 6px 12px;
      font-family: 'Roboto', sans-serif;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s ease;
    }

    .language-selector-button:hover {
      background-color: var(--md-primary-fg-color--light);
    }

    .language-selector-button .lang-name {
      display: inline;
    }

    @media screen and (max-width: 76.1875em) {
      .language-selector-button .lang-name {
        display: none;
      }
    }

    .language-dropdown {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 4px;
      background-color: var(--md-default-bg-color);
      border: 1px solid var(--md-primary-fg-color);
      border-radius: 4px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      min-width: 200px;
      max-height: 400px;
      overflow-y: auto;
    }

    .language-selector:hover .language-dropdown,
    .language-dropdown:hover {
      display: block;
    }

    .language-option {
      padding: 8px 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      transition: background-color 0.2s ease;
    }

    .language-option:hover {
      background-color: var(--md-primary-fg-color--light);
    }

    .language-option.active {
      background-color: rgba(0, 150, 136, 0.1);
      font-weight: 500;
    }

    [data-md-color-scheme="slate"] .language-option.active {
      background-color: rgba(0, 229, 255, 0.08);
    }

    /* Container for translate widget in header */
    .md-header__translate {
      display: flex;
      align-items: center;
      margin-left: auto;
      padding-right: 12px;
    }
  </style>
{% endblock %}

{% block header %}
  {{ super() }}
  <div class="md-header__translate">
    <div id="google_translate_element"></div>
    <div class="language-selector">
      <div class="language-selector-button" id="language-selector-button">
        ğŸ‡¬ğŸ‡§ <span class="lang-name">English</span>
      </div>
      <div class="language-dropdown">
        <div class="language-option" onclick="changeLanguage('en')">
          ğŸ‡¬ğŸ‡§ English
        </div>
        <div class="language-option" onclick="changeLanguage('es')">
          ğŸ‡ªğŸ‡¸ EspaÃ±ol
        </div>
        <div class="language-option" onclick="changeLanguage('fr')">
          ğŸ‡«ğŸ‡· FranÃ§ais
        </div>
        <div class="language-option" onclick="changeLanguage('de')">
          ğŸ‡©ğŸ‡ª Deutsch
        </div>
        <div class="language-option" onclick="changeLanguage('pt')">
          ğŸ‡µğŸ‡¹ PortuguÃªs
        </div>
        <div class="language-option" onclick="changeLanguage('ja')">
          ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª
        </div>
        <div class="language-option" onclick="changeLanguage('zh-CN')">
          ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡
        </div>
        <div class="language-option" onclick="changeLanguage('zh-TW')">
          ğŸ‡¹ğŸ‡¼ ç¹é«”ä¸­æ–‡
        </div>
        <div class="language-option" onclick="changeLanguage('ko')">
          ğŸ‡°ğŸ‡· í•œêµ­ì–´
        </div>
        <div class="language-option" onclick="changeLanguage('ru')">
          ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹
        </div>
        <div class="language-option" onclick="changeLanguage('it')">
          ğŸ‡®ğŸ‡¹ Italiano
        </div>
        <div class="language-option" onclick="changeLanguage('nl')">
          ğŸ‡³ğŸ‡± Nederlands
        </div>
        <div class="language-option" onclick="changeLanguage('pl')">
          ğŸ‡µğŸ‡± Polski
        </div>
        <div class="language-option" onclick="changeLanguage('tr')">
          ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e
        </div>
        <div class="language-option" onclick="changeLanguage('ar')">
          ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
        </div>
        <div class="language-option" onclick="changeLanguage('hi')">
          ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€
        </div>
        <div class="language-option" onclick="changeLanguage('id')">
          ğŸ‡®ğŸ‡© Bahasa Indonesia
        </div>
        <div class="language-option" onclick="changeLanguage('th')">
          ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢
        </div>
        <div class="language-option" onclick="changeLanguage('vi')">
          ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t
        </div>
      </div>
    </div>
  </div>
{% endblock %}
